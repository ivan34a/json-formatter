import requests
import json

# --- –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø ---
API_KEY = "–í–ê–®_SERPAPI_–ö–õ–Æ–ß"
SOCIAL_PLATFORMS = [
    "facebook.com", 
    "instagram.com", 
    "linkedin.com", 
    "twitter.com", 
    "tiktok.com", 
    "pinterest.com"
]

def search_social_media_by_photo(image_url):
    print(f"üöÄ –ó–∞–ø—É—Å–∫ –ø–æ—à—É–∫—É –¥–ª—è: {image_url}")
    
    endpoint = "https://serpapi.com/search"
    params = {
        "engine": "google_lens",
        "url": image_url,
        "api_key": API_KEY,
        "hl": "uk"
    }

    try:
        response = requests.get(endpoint, params=params)
        data = response.json()
        
        visual_matches = data.get("visual_matches", [])
        social_results = []

        # –§—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ –∑–∞ –¥–æ–º–µ–Ω–∞–º–∏ —Å–æ—Ü–º–µ—Ä–µ–∂
        for match in visual_matches:
            link = match.get("link", "").lower()
            source = match.get("source", "")
            
            # –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ, —á–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞–ª–µ–∂–∏—Ç—å –¥–æ –≤—ñ–¥–æ–º–∏—Ö —Å–æ—Ü–º–µ—Ä–µ–∂
            if any(platform in link for platform in SOCIAL_PLATFORMS):
                social_results.append({
                    "title": match.get("title"),
                    "link": link,
                    "source": source
                })

        return social_results

    except Exception as e:
        print(f"‚ùå –ü–æ–º–∏–ª–∫–∞: {e}")
        return []

# --- –ü–†–ò–ö–õ–ê–î –ó–ê–ü–£–°–ö–£ ---
# URL –≤–∞—à–æ–≥–æ —Ñ–æ—Ç–æ (–≤–æ–Ω–æ –º–∞—î –±—É—Ç–∏ –¥–æ—Å—Ç—É–ø–Ω–∏–º –≤ —ñ–Ω—Ç–µ—Ä–Ω–µ—Ç—ñ)
target_photo = "URL_–í–ê–®–û–ì–û_–§–û–¢–û" 

results = search_social_media_by_photo(target_photo)

if results:
    print(f"\n‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –∑–±—ñ–≥—ñ–≤ —É —Å–æ—Ü–º–µ—Ä–µ–∂–∞—Ö: {len(results)}")
    for i, res in enumerate(results, 1):
        print(f"{i}. [{res['source']}] {res['title']}")
        print(f"   –ü–æ—Å–∏–ª–∞–Ω—è: {res['link']}\n")
else:
    print("\n‚ÑπÔ∏è –ó–±—ñ–≥—ñ–≤ —É —Å–æ—Ü—ñ–∞–ª—å–Ω–∏—Ö –º–µ—Ä–µ–∂–∞—Ö –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.")
